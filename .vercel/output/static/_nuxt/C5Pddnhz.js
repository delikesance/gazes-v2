import{d as e,r as l,k as a,l as s,o as t,b as n,m as r,C as i,f as o,h as u,_ as c,t as d,E as v,D as m,n as p,F as g,e as h,a as y,g as b,B as f,v as x,u as k,j as w,G as z,H as C,p as S,I as A,q}from"#entry";import{u as E,C as V}from"./IxaEYVKU.js";import{u as M}from"./DX0gWob3.js";const j={class:"genre-filter border border-zinc-800 rounded-xl bg-zinc-900/40"},F=["aria-expanded"],G={class:"flex items-center gap-2 text-sm"},H={class:"font-medium"},_={key:0,class:"ml-2 text-xs px-2 py-0.5 rounded-full bg-violet-600/20 text-violet-300 border border-violet-700/40"},P={class:"p-3 sm:p-4"},R={class:"relative mb-3"},T={class:"flex items-center justify-between mb-2"},D={class:"text-xs text-zinc-400"},L=["onKeydown"],J=["value","checked","onChange"],O={class:"truncate"},Y=e({__name:"GenreFilter",props:{modelValue:{},allGenres:{},label:{},maxHeight:{},collapsible:{type:Boolean},startOpen:{type:Boolean}},emits:["update:modelValue","clear"],setup(e,{emit:x}){const k=e,w=x,z=l([...k.modelValue]),C=l(""),S=l(!k.collapsible||!!k.startOpen);a(()=>k.modelValue,e=>{z.value=[...e]},{deep:!0});const A=s(()=>{const e=C.value.trim().toLowerCase();return e?k.allGenres.filter(l=>l.toLowerCase().includes(e)):k.allGenres}),q=s(()=>z.value.length);function E(e){const l=z.value.indexOf(e);l>=0?z.value.splice(l,1):z.value.push(e),w("update:modelValue",[...z.value])}function V(){z.value=[],w("update:modelValue",[]),w("clear")}return t(()=>{k.collapsible&&q.value>0&&(S.value=!0)}),(l,a)=>{const s=c;return y(),n("div",j,[e.collapsible?(y(),n("button",{key:0,class:"w-full flex items-center justify-between gap-3 px-4 py-3 hover:bg-zinc-900/60 rounded-t-xl","aria-expanded":S.value,onClick:a[0]||(a[0]=e=>S.value=!S.value)},[o("div",G,[u(s,{name:"heroicons:sparkles",class:"w-4 h-4 text-violet-400"}),o("span",H,d(e.label||"Genres"),1),q.value?(y(),n("span",_,d(q.value),1)):r("",!0)]),u(s,{name:S.value?"heroicons:chevron-up":"heroicons:chevron-down",class:"w-4 h-4 text-zinc-400"},null,8,["name"])],8,F)):r("",!0),i(o("div",P,[o("div",R,[i(o("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>C.value=e),type:"search",class:"input input-with-icon w-full sm:w-80",placeholder:"Rechercher un genre..."},null,512),[[m,C.value]]),u(s,{name:"heroicons:magnifying-glass",class:"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500"}),C.value?(y(),n("button",{key:0,onClick:a[2]||(a[2]=e=>C.value=""),class:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-zinc-800 rounded"},[u(s,{name:"heroicons:x-mark",class:"w-4 h-4"})])):r("",!0)]),o("div",T,[o("span",D,d(q.value)+" sélectionné(s) ",1),q.value?(y(),n("button",{key:0,class:"text-xs text-zinc-400 hover:text-zinc-200 underline",onClick:V},"Effacer")):r("",!0)]),o("div",{class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",style:p({maxHeight:(e.maxHeight??240)+"px",overflow:"auto"})},[(y(!0),n(g,null,h(A.value,e=>(y(),n("label",{key:e,class:b(["flex items-center gap-2 px-2 py-1.5 rounded border text-xs cursor-pointer select-none bg-zinc-900/40 border-zinc-800 hover:border-zinc-700",{"border-violet-600 bg-violet-600/15 text-violet-200":z.value.includes(e)}]),tabindex:"0",onKeydown:l=>function(e,l){" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),E(l))}(l,e)},[o("input",{type:"checkbox",class:"accent-violet-600 rounded-sm",value:e,checked:z.value.includes(e),onChange:l=>E(e),onClick:a[3]||(a[3]=f(()=>{},["stop"]))},null,40,J),o("span",O,d(e),1)],42,L))),128))],4)],512),[[v,!e.collapsible||S.value]])])}}}),$=Object.assign(x(Y,[["__scopeId","data-v-3d44a201"]]),{__name:"GenreFilter"}),I=["Action","Adolescence","Aliens / Extra-terrestres","Amitié","Amour","Apocalypse","Art","Arts martiaux","Assassinat","Autre monde","Aventure","Combats","Comédie","Crime","Cyberpunk","Danse","Démons","Détective","Donghua","Dragon","Drame","Ecchi","Ecole","Elfe","Enquête","Famille","Fantastique","Fantasy","Fantômes","Futur","Gastronomie","Ghibli","Guerre","Harcèlement","Harem","Harem inversé","Histoire","Historique","Horreur","Isekai","Jeunesse","Jeux","Jeux vidéo","Josei","Journalisme","Mafia","Magical girl","Magie","Maladie","Mariage","Mature","Mechas","Médiéval","Militaire","Monde virtuel","Monstres","Musique","Mystère","Nekketsu","Ninjas","Nostalgie","Paranormal","Philosophie","Pirates","Police","Politique","Post-apocalyptique","Pouvoirs psychiques","Préhistoire","Prison","Psychologique","Quotidien","Religion","Réincarnation / Transmigration","Romance","Samouraïs","School Life","Science-Fantasy","Science-fiction","Scientifique","Seinen","Shôjo","Shôjo-Ai","Shônen","Shônen-Ai","Slice of Life","Société","Sport","Super pouvoirs","Super-héros","Surnaturel","Survie","Survival game","Technologies","Thriller","Tournois","Travail","Vampires","Vengeance","Voyage","Voyage temporel","Webcomic","Yakuza","Yaoi","Yokai","Yuri"].sort((e,l)=>e.localeCompare(l,void 0,{sensitivity:"base"})),B={class:"section px-5 md:px-20"},N={class:"flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-6"},U={class:"muted"},K={key:0,class:"flex items-center gap-3"},Q={class:"text-sm muted"},W={class:"space-y-4 mb-6"},X={class:"relative"},Z={class:"flex flex-wrap gap-2"},ee=["onClick"],le={class:"min-h-[500px]"},ae={key:0,class:"space-y-4"},se={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"},te={key:1,class:"text-center py-16"},ne={class:"muted mb-4"},re={key:2,class:"text-center py-16"},ie={class:"muted mb-4"},oe={key:3,class:"poster-grid"},ue={key:0,class:"space-y-4"},ce={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"},de={key:1,class:"text-center py-16"},ve={class:"muted mb-4"},me={class:"flex justify-center gap-3"},pe={key:0,class:"ml-1"},ge={key:2,class:"text-center py-16"},he={class:"muted mb-4"},ye={class:"poster-grid"},be={key:0,class:"text-center py-8"},fe={key:1,class:"text-center py-8"},xe={class:"muted mb-3"},ke={key:2,class:"text-center py-8"},we=x(e({__name:"catalogue",setup(e){E({title:"Catalogue - Gazes",description:"Parcourez notre vaste collection d'animations"});const v=k(),p=w(),f=l(Array.isArray(v.query.genre)?v.query.genre:v.query.genre?[String(v.query.genre)]:[]),x=l("string"==typeof v.query.type?v.query.type:""),j=l([]),F=l(!1),G=l(!0),H=l(1),_=l(!0),P=l(null),R=l(null),T=l(0),{query:D,search:L,executeSearch:J,clearSearch:O}=M(async e=>{const l=await $fetch("/api/catalogue",{params:{search:e,genre:f.value,type:x.value,page:1}});return l?.items||[]},{debounceMs:300,minLength:2}),Y=String(v.query.search||"");Y&&(D.value=Y);const we=I,ze=s(()=>!!D.value&&D.value.trim().length>=2),Ce=s(()=>f.value.length>0||!!x.value),Se=s(()=>f.value.length+(x.value?1:0)),Ae=s(()=>!F.value&&!G.value&&0===j.value.length&&!ze.value),qe=s(()=>L.isEmpty.value&&L.hasSearched.value);a([D,f,x],()=>{(()=>{const e={};D.value&&(e.search=D.value),f.value.length&&(e.genre=f.value),x.value&&(e.type=x.value),p.replace({path:"/catalogue",query:e})})()},{deep:!0});const Ee=()=>{if(F.value||!_.value||ze.value)return;const e=window.pageYOffset||document.documentElement.scrollTop,l=window.innerHeight,a=document.documentElement.scrollHeight;a-(e+l)<=.05*a&&(H.value+=1,je(H.value))},Ve=()=>{window.addEventListener("scroll",Ee,{passive:!0})},Me=()=>{window.removeEventListener("scroll",Ee)},je=async e=>{if(!F.value&&_.value&&!ze.value){F.value=!0,P.value=null;try{const l=await $fetch("/api/catalogue",{params:{genre:f.value,type:x.value,page:String(e)}});if(200!==(l?.status??200))return void(_.value=!1);const a=l?.items||[];if(1===e)j.value=a;else{const e=new Set(j.value.map(e=>e.id)),l=a.filter(l=>!e.has(l.id));j.value.push(...l)}_.value=a.length>0,T.value=0}catch(l){console.error("Fetch error:",l),P.value=l instanceof Error?l.message:"Failed to load content",_.value=1===e||_.value}finally{F.value=!1,G.value=!1}}},Fe=()=>{Me(),j.value=[],H.value=1,_.value=!0,P.value=null,T.value=0,G.value=!0,ze.value||je(1)},Ge=()=>{T.value+=1,0===j.value.length?je(1):je(H.value)},He=e=>{x.value=x.value===e?"":e},_e=()=>{f.value=[],x.value=""},Pe=()=>{D.value="",O()},Re=()=>{D.value="",f.value=[],x.value="",O(),Fe()};let Te=null;return a(()=>[...f.value],()=>{Te&&clearTimeout(Te),Te=setTimeout(()=>{Fe(),C(()=>{Ve()})},250)},{deep:!0}),z(()=>{Me(),Te&&(clearTimeout(Te),Te=null)}),t(()=>{Fe(),C(()=>{Ve()})}),z(()=>{Me()}),(e,l)=>{const a=c;return y(),n("div",null,[o("section",B,[o("div",N,[o("div",null,[l[5]||(l[5]=o("h1",{class:"mb-2"},"Catalogue",-1)),o("p",U,d(ze.value?`Résultats pour "${S(D)}"`:"Découvrez notre vaste collection"),1)]),Ce.value||S(D)?(y(),n("div",K,[o("span",Q,d(Se.value)+" filtre(s) actif(s)",1),o("button",{onClick:Re,class:"btn ghost text-sm"}," Tout effacer ")])):r("",!0)]),o("div",W,[o("div",X,[i(o("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>A(D)?D.value=e:null),type:"search",class:"input input-with-icon w-full sm:w-[420px]",placeholder:"Rechercher un anime, film..."},null,512),[[m,S(D)]]),u(a,{name:"heroicons:magnifying-glass",class:"pointer-events-none absolute left-4 top-1/2 transform -translate-y-1/2 w-4 h-4 text-zinc-500"}),S(D)?(y(),n("button",{key:0,onClick:l[1]||(l[1]=(...e)=>S(O)&&S(O)(...e)),class:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 hover:bg-zinc-800 rounded"},[u(a,{name:"heroicons:x-mark",class:"w-4 h-4"})])):r("",!0)]),o("div",Z,[l[6]||(l[6]=o("span",{class:"text-sm font-medium text-zinc-400 mr-2 self-center"},"Type:",-1)),(y(),n(g,null,h(["series","movie"],e=>o("button",{key:e,onClick:l=>He(e),class:b(["px-3 py-1.5 rounded-lg text-sm font-medium transition-all duration-200",x.value===e?"bg-violet-600 text-white shadow-lg":"bg-zinc-800 text-zinc-300 hover:bg-zinc-700"])},d("series"===e?"Séries":"Films"),11,ee)),64)),x.value?(y(),n("button",{key:0,onClick:l[2]||(l[2]=e=>He("")),class:"px-3 py-1.5 rounded-lg text-sm font-medium bg-red-600/20 text-red-400 hover:bg-red-600/30 transition-all duration-200"},[u(a,{name:"heroicons:x-mark",class:"w-4 h-4"})])):r("",!0)]),u($,{modelValue:f.value,"onUpdate:modelValue":l[3]||(l[3]=e=>f.value=e),"all-genres":S(we),label:"Genres",collapsible:!0,"start-open":!1,"max-height":260,onClear:_e},null,8,["modelValue","all-genres"])]),l[20]||(l[20]=o("div",{class:"divider"},null,-1)),o("div",le,[ze.value?(y(),n(g,{key:0},[S(L).loading.value?(y(),n("div",ae,[l[7]||(l[7]=o("div",{class:"flex items-center gap-3 mb-4"},[o("div",{class:"w-5 h-5 border-2 border-violet-600 border-t-transparent rounded-full animate-spin"}),o("span",{class:"muted"},"Recherche en cours...")],-1)),o("div",se,[(y(),n(g,null,h(12,e=>o("div",{key:e,class:"aspect-[9/12] bg-zinc-900/40 border border-zinc-800 rounded-xl animate-pulse"})),64))])])):S(L).error.value?(y(),n("div",te,[u(a,{name:"heroicons:exclamation-triangle",class:"w-16 h-16 text-amber-500 mx-auto mb-4"}),l[8]||(l[8]=o("h3",{class:"text-xl font-semibold mb-2"}," Erreur de recherche ",-1)),o("p",ne,d(S(L).error.value),1),o("button",{onClick:l[4]||(l[4]=e=>S(J)(S(D))),class:"btn primary"}," Réessayer ")])):qe.value?(y(),n("div",re,[u(a,{name:"heroicons:magnifying-glass",class:"w-16 h-16 text-zinc-500 mx-auto mb-4"}),l[9]||(l[9]=o("h3",{class:"text-xl font-semibold mb-2"}," Aucun résultat ",-1)),o("p",ie,' Aucun contenu trouvé pour "'+d(S(D))+'" ',1),o("div",{class:"flex justify-center gap-3"},[o("button",{onClick:Pe,class:"btn secondary"}," Effacer la recherche ")])])):(y(),n("div",oe,[(y(!0),n(g,null,h(S(L).results.value,e=>(y(),n("div",{class:"poster-item",key:e.id},[u(V,{to:`/anime/${e.id}`,src:e.image,title:e.title,size:"sm",fluid:""},null,8,["to","src","title"])]))),128)),S(L).results.value?.length?(y(),n(g,{key:0},[(y(!0),n(g,null,h((5-S(L).results.value.length%5)%5,e=>(y(),n("div",{key:"search-filler-5-"+e,class:"poster-item poster-filler-5","aria-hidden":""},[...l[10]||(l[10]=[o("div",{class:"poster-placeholder"},null,-1)])]))),128)),(y(!0),n(g,null,h((6-S(L).results.value.length%6)%6,e=>(y(),n("div",{key:"search-filler-6-"+e,class:"poster-item poster-filler-6","aria-hidden":""},[...l[11]||(l[11]=[o("div",{class:"poster-placeholder"},null,-1)])]))),128))],64)):r("",!0)]))],64)):(y(),n(g,{key:1},[G.value?(y(),n("div",ue,[l[12]||(l[12]=o("div",{class:"flex items-center gap-3 mb-4"},[o("div",{class:"w-5 h-5 border-2 border-violet-600 border-t-transparent rounded-full animate-spin"}),o("span",{class:"muted"},"Chargement du catalogue...")],-1)),o("div",ce,[(y(),n(g,null,h(18,e=>o("div",{key:e,class:"aspect-[9/12] bg-zinc-900/40 border border-zinc-800 rounded-xl animate-pulse"})),64))])])):P.value&&0===j.value.length?(y(),n("div",de,[u(a,{name:"heroicons:exclamation-triangle",class:"w-16 h-16 text-amber-500 mx-auto mb-4"}),l[14]||(l[14]=o("h3",{class:"text-xl font-semibold mb-2"}," Erreur de chargement ",-1)),o("p",ve,d(P.value),1),o("div",me,[o("button",{onClick:Ge,class:"btn primary"},[l[13]||(l[13]=q(" Réessayer ",-1)),T.value>0?(y(),n("span",pe,"("+d(T.value)+")",1)):r("",!0)]),o("button",{onClick:Re,class:"btn secondary"}," Réinitialiser les filtres ")])])):Ae.value?(y(),n("div",ge,[u(a,{name:"heroicons:film",class:"w-16 h-16 text-zinc-500 mx-auto mb-4"}),l[15]||(l[15]=o("h3",{class:"text-xl font-semibold mb-2"}," Aucun contenu ",-1)),o("p",he,d(Ce.value?"Aucun contenu ne correspond à vos filtres":"Aucun contenu disponible pour le moment"),1),Ce.value?(y(),n("button",{key:0,onClick:_e,class:"btn primary"}," Effacer les filtres ")):r("",!0)])):(y(),n(g,{key:3},[o("div",ye,[(y(!0),n(g,null,h(j.value,e=>(y(),n("div",{class:"poster-item",key:e.id},[u(V,{to:`/anime/${e.id}`,src:e.image,title:e.title,size:"sm",fluid:""},null,8,["to","src","title"])]))),128)),j.value?.length?(y(),n(g,{key:0},[(y(!0),n(g,null,h((5-j.value.length%5)%5,e=>(y(),n("div",{key:"browse-filler-5-"+e,class:"poster-item poster-filler-5","aria-hidden":""},[...l[16]||(l[16]=[o("div",{class:"poster-placeholder"},null,-1)])]))),128)),(y(!0),n(g,null,h((6-j.value.length%6)%6,e=>(y(),n("div",{key:"browse-filler-6-"+e,class:"poster-item poster-filler-6","aria-hidden":""},[...l[17]||(l[17]=[o("div",{class:"poster-placeholder"},null,-1)])]))),128))],64)):r("",!0)]),o("div",{ref_key:"sentinel",ref:R,class:"h-px mt-8"},null,512),F.value&&!G.value?(y(),n("div",be,[...l[18]||(l[18]=[o("div",{class:"flex items-center justify-center gap-3"},[o("div",{class:"w-5 h-5 border-2 border-violet-600 border-t-transparent rounded-full animate-spin"}),o("span",{class:"muted"},"Chargement de plus de contenus...")],-1)])])):r("",!0),P.value&&j.value.length>0?(y(),n("div",fe,[o("p",xe,d(P.value),1),o("button",{onClick:Ge,class:"btn secondary"}," Réessayer ")])):r("",!0),!_.value&&j.value.length>0&&!F.value?(y(),n("div",ke,[...l[19]||(l[19]=[o("p",{class:"muted"}," Vous avez atteint la fin du catalogue ",-1)])])):r("",!0)],64))],64))])])])}}}),[["__scopeId","data-v-2aa80c67"]]);export{we as default};

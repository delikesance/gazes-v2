import { u as S, _ as $ } from './index-BZnvd90h.mjs';
import { defineComponent, ref, computed, watch, nextTick, unref, mergeProps, useSSRContext } from 'vue';
import { ssrRenderAttrs, ssrInterpolate, ssrRenderAttr, ssrRenderComponent, ssrRenderList, ssrRenderClass, ssrRenderStyle, ssrIncludeBooleanAttr } from 'vue/server-renderer';
import { J } from './CardPoster-BLzLRno_.mjs';
import { u } from './useSearch-BmyD_PFd.mjs';
import { b as Ct, u as Ae, a as Se } from './server.mjs';
import { a7 as SORTED_GENRES } from '../nitro/nitro.mjs';
import '@iconify/vue';
import '@iconify/utils/lib/css/icon';
import './asyncData-BOLdWyFS.mjs';
import 'perfect-debounce';
import '../routes/renderer.mjs';
import 'vue-bundle-renderer/runtime';
import 'unhead/server';
import 'devalue';
import 'unhead/plugins';
import 'unhead/utils';
import 'cheerio';
import 'jsonwebtoken';
import 'bcryptjs';
import 'node:http';
import 'node:https';
import 'node:events';
import 'node:buffer';
import 'node:fs';
import 'node:path';
import 'node:crypto';
import '@supabase/supabase-js';
import '@iconify/utils';
import 'consola';
import 'node:url';
import 'ipx';
import 'vue-router';

const _=defineComponent({__name:"GenreFilter",__ssrInlineRender:true,props:{modelValue:{},allGenres:{},label:{},maxHeight:{},collapsible:{type:Boolean},startOpen:{type:Boolean}},emits:["update:modelValue","clear"],setup(a,{emit:t}){const n=a,i=ref([...n.modelValue]),r=ref(""),b=ref(!n.collapsible||!!n.startOpen);watch(()=>n.modelValue,e=>{i.value=[...e];},{deep:true});const f=computed(()=>{const e=r.value.trim().toLowerCase();return e?n.allGenres.filter(a=>a.toLowerCase().includes(e)):n.allGenres}),y=computed(()=>i.value.length);return (t,s,l,d)=>{const n=$;s(`<div${ssrRenderAttrs(mergeProps({class:"genre-filter border border-zinc-800 rounded-xl bg-zinc-900/40"},d))} data-v-3d44a201>`),a.collapsible?(s(`<button class="w-full flex items-center justify-between gap-3 px-4 py-3 hover:bg-zinc-900/60 rounded-t-xl"${ssrRenderAttr("aria-expanded",b.value)} data-v-3d44a201><div class="flex items-center gap-2 text-sm" data-v-3d44a201>`),s(ssrRenderComponent(n,{name:"heroicons:sparkles",class:"w-4 h-4 text-violet-400"},null,l)),s(`<span class="font-medium" data-v-3d44a201>${ssrInterpolate(a.label||"Genres")}</span>`),y.value?s(`<span class="ml-2 text-xs px-2 py-0.5 rounded-full bg-violet-600/20 text-violet-300 border border-violet-700/40" data-v-3d44a201>${ssrInterpolate(y.value)}</span>`):s("\x3c!----\x3e"),s("</div>"),s(ssrRenderComponent(n,{name:b.value?"heroicons:chevron-up":"heroicons:chevron-down",class:"w-4 h-4 text-zinc-400"},null,l)),s("</button>")):s("\x3c!----\x3e"),s(`<div class="p-3 sm:p-4" style="${ssrRenderStyle(!a.collapsible||b.value?null:{display:"none"})}" data-v-3d44a201><div class="relative mb-3" data-v-3d44a201><input${ssrRenderAttr("value",r.value)} type="search" class="input input-with-icon w-full sm:w-80" placeholder="Rechercher un genre..." data-v-3d44a201>`),s(ssrRenderComponent(n,{name:"heroicons:magnifying-glass",class:"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500"},null,l)),r.value?(s('<button class="absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-zinc-800 rounded" data-v-3d44a201>'),s(ssrRenderComponent(n,{name:"heroicons:x-mark",class:"w-4 h-4"},null,l)),s("</button>")):s("\x3c!----\x3e"),s(`</div><div class="flex items-center justify-between mb-2" data-v-3d44a201><span class="text-xs text-zinc-400" data-v-3d44a201>${ssrInterpolate(y.value)} sélectionné(s) </span>`),y.value?s('<button class="text-xs text-zinc-400 hover:text-zinc-200 underline" data-v-3d44a201>Effacer</button>'):s("\x3c!----\x3e"),s(`</div><div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2" style="${ssrRenderStyle({maxHeight:(a.maxHeight??240)+"px",overflow:"auto"})}" data-v-3d44a201>\x3c!--[--\x3e`),ssrRenderList(f.value,e=>{s(`<label class="${ssrRenderClass([{"border-violet-600 bg-violet-600/15 text-violet-200":i.value.includes(e)},"flex items-center gap-2 px-2 py-1.5 rounded border text-xs cursor-pointer select-none bg-zinc-900/40 border-zinc-800 hover:border-zinc-700"])}" tabindex="0" data-v-3d44a201><input type="checkbox" class="accent-violet-600 rounded-sm"${ssrRenderAttr("value",e)}${ssrIncludeBooleanAttr(i.value.includes(e))?" checked":""} data-v-3d44a201><span class="truncate" data-v-3d44a201>${ssrInterpolate(e)}</span></label>`);}),s("\x3c!--]--\x3e</div></div></div>");}}}),j=_.setup;_.setup=(e,a)=>{const t=useSSRContext();return (t.modules||(t.modules=new Set)).add("components/GenreFilter.vue"),j?j(e,a):void 0};const C=Object.assign(Ct(_,[["__scopeId","data-v-3d44a201"]]),{__name:"GenreFilter"}),k=defineComponent({__name:"catalogue",__ssrInlineRender:true,setup(t){S({title:"Catalogue - Gazes",description:"Parcourez notre vaste collection d'animations"});const c=Ae(),n=Se(),p=ref(Array.isArray(c.query.genre)?c.query.genre:c.query.genre?[String(c.query.genre)]:[]),h=ref("string"==typeof c.query.type?c.query.type:""),y=ref([]),_=ref(false),j=ref(true),k=ref(1),U=ref(true),q=ref(null);ref(null);const E=ref(0),{query:R,search:G}=u(async e=>{const a=await $fetch("/api/catalogue",{params:{search:e,genre:p.value,type:h.value,page:1}});return a?.items||[]},{debounceMs:300,minLength:2}),S$1=String(c.query.search||"");S$1&&(R.value=S$1);const A=SORTED_GENRES,V=computed(()=>!!R.value&&R.value.trim().length>=2),F=computed(()=>p.value.length>0||!!h.value),H=computed(()=>p.value.length+(h.value?1:0)),L=computed(()=>!_.value&&!j.value&&0===y.value.length&&!V.value),T=computed(()=>G.isEmpty.value&&G.hasSearched.value);watch([R,p,h],()=>{(()=>{const e={};R.value&&(e.search=R.value),p.value.length&&(e.genre=p.value),h.value&&(e.type=h.value),n.replace({path:"/catalogue",query:e});})();},{deep:true});const I=()=>{if(_.value||!U.value||V.value)return;const e=(void 0).pageYOffset||(void 0).documentElement.scrollTop,a=(void 0).innerHeight,t=(void 0).documentElement.scrollHeight;t-(e+a)<=.05*t&&(k.value+=1,O(k.value));},O=async e=>{if(!_.value&&U.value&&!V.value){_.value=true,q.value=null;try{const a=await $fetch("/api/catalogue",{params:{genre:p.value,type:h.value,page:String(e)}});if(200!==(a?.status??200))return void(U.value=!1);const t=a?.items||[];if(1===e)y.value=t;else {const e=new Set(y.value.map(e=>e.id)),a=t.filter(a=>!e.has(a.id));y.value.push(...a);}U.value=t.length>0,E.value=0;}catch(a){console.error("Fetch error:",a),q.value=a instanceof Error?a.message:"Failed to load content",U.value=1===e||U.value;}finally{_.value=false,j.value=false;}}},B=()=>{(void 0).removeEventListener("scroll",I),y.value=[],k.value=1,U.value=true,q.value=null,E.value=0,j.value=true,V.value||O(1);},D=()=>{p.value=[],h.value="";};let P=null;return watch(()=>[...p.value],()=>{P&&clearTimeout(P),P=setTimeout(()=>{B(),nextTick(()=>{(void 0).addEventListener("scroll",I,{passive:true});});},250);},{deep:true}),(a,t,s,l)=>{const d=$;t(`<div${ssrRenderAttrs(l)} data-v-2aa80c67><section class="section px-5 md:px-20" data-v-2aa80c67><div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-6" data-v-2aa80c67><div data-v-2aa80c67><h1 class="mb-2" data-v-2aa80c67>Catalogue</h1><p class="muted" data-v-2aa80c67>${ssrInterpolate(V.value?`Résultats pour "${unref(R)}"`:"Découvrez notre vaste collection")}</p></div>`),F.value||unref(R)?t(`<div class="flex items-center gap-3" data-v-2aa80c67><span class="text-sm muted" data-v-2aa80c67>${ssrInterpolate(H.value)} filtre(s) actif(s)</span><button class="btn ghost text-sm" data-v-2aa80c67> Tout effacer </button></div>`):t("\x3c!----\x3e"),t(`</div><div class="space-y-4 mb-6" data-v-2aa80c67><div class="relative" data-v-2aa80c67><input${ssrRenderAttr("value",unref(R))} type="search" class="input input-with-icon w-full sm:w-[420px]" placeholder="Rechercher un anime, film..." data-v-2aa80c67>`),t(ssrRenderComponent(d,{name:"heroicons:magnifying-glass",class:"pointer-events-none absolute left-4 top-1/2 transform -translate-y-1/2 w-4 h-4 text-zinc-500"},null,s)),unref(R)?(t('<button class="absolute right-3 top-1/2 transform -translate-y-1/2 p-1 hover:bg-zinc-800 rounded" data-v-2aa80c67>'),t(ssrRenderComponent(d,{name:"heroicons:x-mark",class:"w-4 h-4"},null,s)),t("</button>")):t("\x3c!----\x3e"),t('</div><div class="flex flex-wrap gap-2" data-v-2aa80c67><span class="text-sm font-medium text-zinc-400 mr-2 self-center" data-v-2aa80c67>Type:</span>\x3c!--[--\x3e'),ssrRenderList(["series","movie"],e=>{t(`<button class="${ssrRenderClass(["px-3 py-1.5 rounded-lg text-sm font-medium transition-all duration-200",h.value===e?"bg-violet-600 text-white shadow-lg":"bg-zinc-800 text-zinc-300 hover:bg-zinc-700"])}" data-v-2aa80c67>${ssrInterpolate("series"===e?"Séries":"Films")}</button>`);}),t("\x3c!--]--\x3e"),h.value?(t('<button class="px-3 py-1.5 rounded-lg text-sm font-medium bg-red-600/20 text-red-400 hover:bg-red-600/30 transition-all duration-200" data-v-2aa80c67>'),t(ssrRenderComponent(d,{name:"heroicons:x-mark",class:"w-4 h-4"},null,s)),t("</button>")):t("\x3c!----\x3e"),t("</div>"),t(ssrRenderComponent(C,{modelValue:p.value,"onUpdate:modelValue":e=>p.value=e,"all-genres":unref(A),label:"Genres",collapsible:true,"start-open":false,"max-height":260,onClear:D},null,s)),t('</div><div class="divider" data-v-2aa80c67></div><div class="min-h-[500px]" data-v-2aa80c67>'),V.value?(t("\x3c!--[--\x3e"),unref(G).loading.value?(t('<div class="space-y-4" data-v-2aa80c67><div class="flex items-center gap-3 mb-4" data-v-2aa80c67><div class="w-5 h-5 border-2 border-violet-600 border-t-transparent rounded-full animate-spin" data-v-2aa80c67></div><span class="muted" data-v-2aa80c67>Recherche en cours...</span></div><div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4" data-v-2aa80c67>\x3c!--[--\x3e'),ssrRenderList(12,e=>{t('<div class="aspect-[9/12] bg-zinc-900/40 border border-zinc-800 rounded-xl animate-pulse" data-v-2aa80c67></div>');}),t("\x3c!--]--\x3e</div></div>")):unref(G).error.value?(t('<div class="text-center py-16" data-v-2aa80c67>'),t(ssrRenderComponent(d,{name:"heroicons:exclamation-triangle",class:"w-16 h-16 text-amber-500 mx-auto mb-4"},null,s)),t(`<h3 class="text-xl font-semibold mb-2" data-v-2aa80c67> Erreur de recherche </h3><p class="muted mb-4" data-v-2aa80c67>${ssrInterpolate(unref(G).error.value)}</p><button class="btn primary" data-v-2aa80c67> Réessayer </button></div>`)):T.value?(t('<div class="text-center py-16" data-v-2aa80c67>'),t(ssrRenderComponent(d,{name:"heroicons:magnifying-glass",class:"w-16 h-16 text-zinc-500 mx-auto mb-4"},null,s)),t(`<h3 class="text-xl font-semibold mb-2" data-v-2aa80c67> Aucun résultat </h3><p class="muted mb-4" data-v-2aa80c67> Aucun contenu trouvé pour &quot;${ssrInterpolate(unref(R))}&quot; </p><div class="flex justify-center gap-3" data-v-2aa80c67><button class="btn secondary" data-v-2aa80c67> Effacer la recherche </button></div></div>`)):(t('<div class="poster-grid" data-v-2aa80c67>\x3c!--[--\x3e'),ssrRenderList(unref(G).results.value,e=>{t('<div class="poster-item" data-v-2aa80c67>'),t(ssrRenderComponent(J,{to:`/anime/${e.id}`,src:e.image,title:e.title,size:"sm",fluid:""},null,s)),t("</div>");}),t("\x3c!--]--\x3e"),unref(G).results.value?.length?(t("\x3c!--[--\x3e\x3c!--[--\x3e"),ssrRenderList((5-unref(G).results.value.length%5)%5,e=>{t('<div class="poster-item poster-filler-5" aria-hidden data-v-2aa80c67><div class="poster-placeholder" data-v-2aa80c67></div></div>');}),t("\x3c!--]--\x3e\x3c!--[--\x3e"),ssrRenderList((6-unref(G).results.value.length%6)%6,e=>{t('<div class="poster-item poster-filler-6" aria-hidden data-v-2aa80c67><div class="poster-placeholder" data-v-2aa80c67></div></div>');}),t("\x3c!--]--\x3e\x3c!--]--\x3e")):t("\x3c!----\x3e"),t("</div>")),t("\x3c!--]--\x3e")):(t("\x3c!--[--\x3e"),j.value?(t('<div class="space-y-4" data-v-2aa80c67><div class="flex items-center gap-3 mb-4" data-v-2aa80c67><div class="w-5 h-5 border-2 border-violet-600 border-t-transparent rounded-full animate-spin" data-v-2aa80c67></div><span class="muted" data-v-2aa80c67>Chargement du catalogue...</span></div><div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4" data-v-2aa80c67>\x3c!--[--\x3e'),ssrRenderList(18,e=>{t('<div class="aspect-[9/12] bg-zinc-900/40 border border-zinc-800 rounded-xl animate-pulse" data-v-2aa80c67></div>');}),t("\x3c!--]--\x3e</div></div>")):q.value&&0===y.value.length?(t('<div class="text-center py-16" data-v-2aa80c67>'),t(ssrRenderComponent(d,{name:"heroicons:exclamation-triangle",class:"w-16 h-16 text-amber-500 mx-auto mb-4"},null,s)),t(`<h3 class="text-xl font-semibold mb-2" data-v-2aa80c67> Erreur de chargement </h3><p class="muted mb-4" data-v-2aa80c67>${ssrInterpolate(q.value)}</p><div class="flex justify-center gap-3" data-v-2aa80c67><button class="btn primary" data-v-2aa80c67> Réessayer `),E.value>0?t(`<span class="ml-1" data-v-2aa80c67>(${ssrInterpolate(E.value)})</span>`):t("\x3c!----\x3e"),t('</button><button class="btn secondary" data-v-2aa80c67> Réinitialiser les filtres </button></div></div>')):L.value?(t('<div class="text-center py-16" data-v-2aa80c67>'),t(ssrRenderComponent(d,{name:"heroicons:film",class:"w-16 h-16 text-zinc-500 mx-auto mb-4"},null,s)),t(`<h3 class="text-xl font-semibold mb-2" data-v-2aa80c67> Aucun contenu </h3><p class="muted mb-4" data-v-2aa80c67>${ssrInterpolate(F.value?"Aucun contenu ne correspond à vos filtres":"Aucun contenu disponible pour le moment")}</p>`),F.value?t('<button class="btn primary" data-v-2aa80c67> Effacer les filtres </button>'):t("\x3c!----\x3e"),t("</div>")):(t('\x3c!--[--\x3e<div class="poster-grid" data-v-2aa80c67>\x3c!--[--\x3e'),ssrRenderList(y.value,e=>{t('<div class="poster-item" data-v-2aa80c67>'),t(ssrRenderComponent(J,{to:`/anime/${e.id}`,src:e.image,title:e.title,size:"sm",fluid:""},null,s)),t("</div>");}),t("\x3c!--]--\x3e"),y.value?.length?(t("\x3c!--[--\x3e\x3c!--[--\x3e"),ssrRenderList((5-y.value.length%5)%5,e=>{t('<div class="poster-item poster-filler-5" aria-hidden data-v-2aa80c67><div class="poster-placeholder" data-v-2aa80c67></div></div>');}),t("\x3c!--]--\x3e\x3c!--[--\x3e"),ssrRenderList((6-y.value.length%6)%6,e=>{t('<div class="poster-item poster-filler-6" aria-hidden data-v-2aa80c67><div class="poster-placeholder" data-v-2aa80c67></div></div>');}),t("\x3c!--]--\x3e\x3c!--]--\x3e")):t("\x3c!----\x3e"),t('</div><div class="h-px mt-8" data-v-2aa80c67></div>'),_.value&&!j.value?t('<div class="text-center py-8" data-v-2aa80c67><div class="flex items-center justify-center gap-3" data-v-2aa80c67><div class="w-5 h-5 border-2 border-violet-600 border-t-transparent rounded-full animate-spin" data-v-2aa80c67></div><span class="muted" data-v-2aa80c67>Chargement de plus de contenus...</span></div></div>'):t("\x3c!----\x3e"),q.value&&y.value.length>0?t(`<div class="text-center py-8" data-v-2aa80c67><p class="muted mb-3" data-v-2aa80c67>${ssrInterpolate(q.value)}</p><button class="btn secondary" data-v-2aa80c67> Réessayer </button></div>`):t("\x3c!----\x3e"),!U.value&&y.value.length>0&&!_.value?t('<div class="text-center py-8" data-v-2aa80c67><p class="muted" data-v-2aa80c67> Vous avez atteint la fin du catalogue </p></div>'):t("\x3c!----\x3e"),t("\x3c!--]--\x3e")),t("\x3c!--]--\x3e")),t("</div></section></div>");}}}),U=k.setup;k.setup=(e,a)=>{const t=useSSRContext();return (t.modules||(t.modules=new Set)).add("pages/catalogue.vue"),U?U(e,a):void 0};const q=Ct(k,[["__scopeId","data-v-2aa80c67"]]);

export { q as default };
//# sourceMappingURL=catalogue-IfAzyo0c.mjs.map
